import{a as h,b as f}from"./chunk-FY6VRBN4.js";import{O as b,T as m,n as d,o as s,r as l,z as n}from"./chunk-CTZ6MGBM.js";var g={production:!0,apiUrl:"http://localhost:5000/"};var p=class extends Error{};p.prototype.name="InvalidTokenError";function $(a){return decodeURIComponent(atob(a).replace(/(.)/g,(t,e)=>{let r=e.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function S(a){let t=a.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return $(t)}catch{return atob(t)}}function y(a,t){if(typeof a!="string")throw new p("Invalid token specified: must be a string");t||(t={});let e=t.header===!0?0:1,r=a.split(".")[e];if(typeof r!="string")throw new p(`Invalid token specified: missing part #${e+1}`);let o;try{o=S(r)}catch(i){throw new p(`Invalid token specified: invalid base64 for part #${e+1} (${i.message})`)}try{return JSON.parse(o)}catch(i){throw new p(`Invalid token specified: invalid json for part #${e+1} (${i.message})`)}}var v=class a{constructor(t){this.http=t}baseUrl=g.apiUrl.replace(/\/$/,"");getToken(){return localStorage.getItem("auth_token")}authHeaderOnly(){let t=this.getToken();return t?new h({Authorization:`Bearer ${t}`}):void 0}buildOptions({isFormData:t=!1}={}){let e=this.authHeaderOnly();if(t)return e?{headers:e}:{};{let r=new h({"Content-Type":"application/json"});return{headers:e?r.set("Authorization",`Bearer ${this.getToken()}`):r}}}toFormData(t){let e=new FormData,r=(o,i)=>{if(i!=null){if(i instanceof Blob||i instanceof File){e.append(o,i);return}if(Array.isArray(i)){i.forEach((c,u)=>{c instanceof Blob||c instanceof File?e.append(`${o}[${u}]`,c):typeof c=="object"&&c!==null?e.append(`${o}[${u}]`,JSON.stringify(c)):e.append(`${o}[${u}]`,String(c))});return}if(typeof i=="object"){e.append(o,JSON.stringify(i));return}e.append(o,String(i))}};return t&&typeof t=="object"&&!(t instanceof FormData)&&Object.keys(t).forEach(o=>r(o,t[o])),e}getProyectos(){return this.http.get(`${this.baseUrl}/api/proyectos`).pipe(l(t=>t.map(e=>({id:e.id??0,nombre:e.nombre,descripcion:e.descripcion??"",descripcionCorta:e.descripcion?e.descripcion.substring(0,100)+"...":"",imagen_url:e.imagen_url??"",imagenUrl:e.imagen_url??"",estado:e.estado??"activo",cliente:e.cliente??""}))))}getProyecto(t){return this.http.get(`${this.baseUrl}/api/proyectos/${t}`).pipe(n(e=>(console.error(`Error fetching proyecto ${t}:`,e),s(()=>e))))}getDetalleProyecto(t){return this.http.get(`${this.baseUrl}/api/proyectos/${t}/detalle`).pipe(n(e=>(console.error(`Error fetching detalle proyecto ${t}:`,e),s(()=>e))))}crearProyecto(t){let e=t instanceof FormData?t:(()=>{let r=new FormData;return r.append("data",JSON.stringify(t)),r})();return this.http.post(`${this.baseUrl}/api/proyectos`,e,this.buildOptions({isFormData:!0})).pipe(n(r=>(console.error("Error creating proyecto:",r),s(()=>r))))}actualizarProyecto(t,e){let r=e instanceof FormData?e:(()=>{let o=new FormData;return o.append("data",JSON.stringify(e)),o})();return this.http.put(`${this.baseUrl}/api/proyectos/${t}`,r,this.buildOptions({isFormData:!0})).pipe(n(o=>(console.error(`Error updating proyecto ${t}:`,o),s(()=>o))))}eliminarProyecto(t){return this.http.delete(`${this.baseUrl}/api/proyectos/${t}`,this.buildOptions()).pipe(n(e=>(console.error(`Error deleting proyecto ${t}:`,e),s(()=>e))))}getServicios(){return this.http.get(`${this.baseUrl}/api/servicios`).pipe(l(t=>t.map(e=>({id:e.id??0,nombre:e.nombre,descripcion:e.descripcion??"",descripcionCorta:e.descripcion?e.descripcion.substring(0,100)+"...":"",imagen_url:e.imagen_url??"",imagenUrl:e.imagen_url??"",estado:e.activo===!0?"activo":e.activo===!1?"inactivo":"completado",icono:e.icono??null,categoria:e.categoria??null}))))}getServicio(t){return this.http.get(`${this.baseUrl}/api/servicios/${t}`).pipe(n(e=>(console.error(`Error fetching servicio ${t}:`,e),s(()=>e))))}crearServicio(t){let e=localStorage.getItem("auth_token"),r=e?{Authorization:`Bearer ${e}`}:void 0;return this.http.post(`${this.baseUrl}/api/servicios`,t,{headers:r})}actualizarServicio(t,e){let o=e instanceof FormData?e:this.toFormData(e);return this.http.put(`${this.baseUrl}/api/servicios/${t}`,o,this.buildOptions({isFormData:!0})).pipe(n(i=>(console.error(`Error updating servicio ${t}:`,i),s(()=>i))))}eliminarServicio(t){return this.http.delete(`${this.baseUrl}/api/servicios/${t}`,this.buildOptions()).pipe(n(e=>(console.error(`Error deleting servicio ${t}:`,e),s(()=>e))))}enviarContacto(t){return this.http.post(`${this.baseUrl}/api/contacto`,t,this.buildOptions()).pipe(n(e=>e&&e.status===404?(console.warn("Contacto endpoint no encontrado en backend, usando fallback mock."),console.log("Datos de contacto enviados (MOCK):",t),d({success:!0})):(console.error("Error al enviar contacto:",e),s(()=>e))))}login(t){return this.http.post(`${this.baseUrl}/api/admin/login`,t,this.buildOptions()).pipe(l(e=>{let r=e?.data?.access_token||null,o=e?.data?.user||null;return r&&this.setToken(r),{token:r,user:o,raw:e}}),n(e=>(console.error("Error en login:",e),s(()=>e))))}recoverPassword(t){return this.http.post(`${this.baseUrl}/api/admin/recover`,{email:t},this.buildOptions()).pipe(n(e=>(console.warn("recoverPassword endpoint no disponible, usando fallback mock."),console.log("Solicitada recuperaci\xF3n de contrase\xF1a para:",t),d({success:!0,message:"Email de recuperaci\xF3n enviado (mock)."}))))}setToken(t){localStorage.setItem("auth_token",t)}isLoggedIn(){let t=this.getToken();if(!t)return!1;try{let r=y(t)?.exp;if(!r)return!0;let o=Math.floor(Date.now()/1e3);return r<o?(this.logoutClientSide(),!1):!0}catch{return this.logoutClientSide(),!1}}logoutClientSide(){localStorage.removeItem("auth_token")}logout(){this.http.post(`${this.baseUrl}/api/admin/logout`,{},this.buildOptions()).subscribe({next:()=>this.logoutClientSide(),error:()=>this.logoutClientSide()})}static \u0275fac=function(e){return new(e||a)(m(f))};static \u0275prov=b({token:a,factory:a.\u0275fac,providedIn:"root"})};export{v as a};
